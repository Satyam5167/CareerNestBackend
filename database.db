## USERS TABLE

CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT,
    email TEXT UNIQUE NOT NULL,
    password TEXT,                    -- NULL if OAuth user
    provider TEXT DEFAULT 'local',    -- local / google
    oauth_id TEXT,                    -- Google ID (nullable)
    profile_completed BOOLEAN DEFAULT FALSE,
    profile_picture TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

## profile TABLE

CREATE TABLE profiles (
    user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,

    full_name TEXT,
    university TEXT,
    cgpa NUMERIC(3,2),
    graduation_year INTEGER,
    phone TEXT,

    skills TEXT[],                    -- stores: {"node","express","javascript"}

    target_roles TEXT[],
    preferred_locations TEXT[],
    is_remote BOOLEAN DEFAULT FALSE,

    github_url TEXT,
    linkedin_url TEXT,

    updated_at TIMESTAMP DEFAULT NOW()
);


## JOBs TABLE

CREATE TABLE jobs (
    id UUID PRIMARY KEY,
    external_id TEXT UNIQUE NOT NULL,
    title TEXT,
    company TEXT,
    location TEXT,
    job_type TEXT,
    work_mode TEXT,
    salary_min NUMERIC,
    salary_max NUMERIC,
    description TEXT,
    apply_link TEXT,
    posted_at TIMESTAMP,
    fetched_at TIMESTAMP DEFAULT NOW(),
    is_active BOOLEAN DEFAULT TRUE,
    source TEXT DEFAULT 'jsearch'
);

##bookmarks

CREATE TABLE job_bookmarks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    job_id UUID NOT NULL REFERENCES jobs(id) ON DELETE CASCADE,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, job_id)
);

## APPLICATIONS TABLE

CREATE TABLE job_applications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    job_id UUID NOT NULL REFERENCES jobs(id) ON DELETE CASCADE,
    status TEXT DEFAULT 'Applied', -- Applied, Interviewing, Offer, Rejected
    applied_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(user_id, job_id)
);

## ATS SCORES TABLE

CREATE TABLE ats_scores (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    resume_name TEXT NOT NULL,
    score INTEGER NOT NULL,
    score_date TIMESTAMP DEFAULT NOW()
);